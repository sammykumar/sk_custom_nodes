import{j as e,u as L}from"./main.js";import{r as o}from"./vendor-DJ1oPbzn.js";const P=({videoUrl:m,onTrimChange:c,initialStartTime:n=0,initialEndTime:d=0})=>{const a=o.useRef(null),x=o.useRef(null),[N,b]=o.useState(0),[V,T]=o.useState(0),[t,r]=o.useState({start:n,end:d}),[l,u]=o.useState(null),[v,s]=o.useState(!1);o.useEffect(()=>{d>0&&r({start:n,end:d})},[n,d]);const i=f=>{const y=Math.floor(f/60),S=Math.floor(f%60),C=Math.floor(f%1*100);return`${y}:${S.toString().padStart(2,"0")}.${C.toString().padStart(2,"0")}`},g=()=>{if(a.current){const f=a.current.duration;b(f),t.end===0&&r({start:0,end:f})}},h=()=>{if(a.current){const f=a.current.currentTime;T(f),f>=t.end&&(a.current.pause(),a.current.currentTime=t.end,s(!1))}},p=()=>{a.current&&((a.current.currentTime<t.start||a.current.currentTime>t.end)&&(a.current.currentTime=t.start),a.current.play(),s(!0))},w=()=>{a.current&&(a.current.pause(),s(!1))},F=f=>{if(!x.current)return 0;const y=x.current.getBoundingClientRect(),S=(f-y.left)/y.width;return Math.max(0,Math.min(N,S*N))},R=(f,y)=>{f.preventDefault(),u(y)},D=o.useCallback(f=>{if(!l||!x.current)return;const y=F(f.clientX);if(l==="start"){const S=Math.min(y,t.end-.1),C={start:S,end:t.end};r(C),c==null||c(C.start,C.end),a.current&&(a.current.currentTime=S,v&&a.current.play())}else if(l==="end"){const S=Math.max(y,t.start+.1),C={start:t.start,end:S};r(C),c==null||c(C.start,C.end),a.current&&(a.current.currentTime=t.start,v&&a.current.play())}},[l,t,c,v]),j=o.useCallback(()=>{u(null)},[]);o.useEffect(()=>{if(l)return document.addEventListener("mousemove",D),document.addEventListener("mouseup",j),()=>{document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",j)}},[l,D,j]);const E=N>0?t.start/N*100:0,k=N>0?t.end/N*100:100,_=N>0?V/N*100:0;return e.jsxs("div",{className:"video-trimmer",children:[e.jsxs("div",{className:"video-container",children:[e.jsx("video",{ref:a,src:m,onLoadedMetadata:g,onTimeUpdate:h,onPlay:()=>s(!0),onPause:()=>s(!1),controls:!1,className:"trim-video"}),e.jsx("div",{className:"video-overlay",children:e.jsx("button",{className:"play-button",onClick:v?w:p,children:v?"⏸️":"▶️"})})]}),e.jsxs("div",{className:"timeline-container",children:[e.jsxs("div",{className:"timeline",ref:x,children:[e.jsx("div",{className:"timeline-track"}),e.jsx("div",{className:"timeline-selection",style:{left:`${E}%`,width:`${k-E}%`}}),e.jsx("div",{className:"timeline-current",style:{left:`${_}%`}}),e.jsx("div",{className:"timeline-handle timeline-handle-start",style:{left:`${E}%`},onMouseDown:f=>R(f,"start"),children:e.jsx("div",{className:"handle-bracket handle-bracket-left",children:"⟨"})}),e.jsx("div",{className:"timeline-handle timeline-handle-end",style:{left:`${k}%`},onMouseDown:f=>R(f,"end"),children:e.jsx("div",{className:"handle-bracket handle-bracket-right",children:"⟩"})})]}),e.jsxs("div",{className:"time-display",children:[e.jsx("span",{children:i(t.start)}),e.jsxs("span",{children:["Duration: ",i(t.end-t.start)]}),e.jsx("span",{children:i(t.end)})]})]})]})},A=()=>{const[m,c]=o.useState([]),[n,d]=o.useState(null),[a,x]=o.useState(""),N=o.useCallback(()=>{var r;if(!((r=window.app)!=null&&r.graph))return[];const t=window.app.graph._nodes;return t?t.filter(l=>l.type==="GeminiVideoDescribe").map(l=>{const u=l;return{id:l.id,type:l.type,uploadedVideoFile:u.uploadedVideoFile,uploadedVideoSubfolder:u.uploadedVideoSubfolder,startTime:u.startTime||0,endTime:u.endTime||0,duration:u.duration||0}}):[]},[]),b=o.useCallback(()=>{const t=N();c(t),!n&&t.length>0&&d(t[0]),n&&!t.find(r=>r.id===n.id)&&(d(null),x(""))},[N,n]);o.useEffect(()=>{if(n&&n.uploadedVideoFile&&n.uploadedVideoSubfolder){const t=`/view?filename=${n.uploadedVideoFile}&subfolder=${n.uploadedVideoSubfolder}&type=input&t=${Date.now()}`;x(t)}else x("")},[n]),o.useEffect(()=>{var r;if(!((r=window.app)!=null&&r.api))return;b();const t=()=>{b()};return window.app.api.addEventListener("graphChanged",t),()=>{var l;(l=window.app)==null||l.api.removeEventListener("graphChanged",t)}},[b]);const V=(t,r)=>{var v,s,i;if(!n||!((v=window.app)!=null&&v.graph))return;const u=window.app.graph._nodes.find(g=>g.id===n.id);if(u){u.startTime=t,u.endTime=r;const g=(s=u.widgets)==null?void 0:s.find(p=>p.name==="start_time"),h=(i=u.widgets)==null?void 0:i.find(p=>p.name==="max_duration");if(g&&(g.value=t),h){const p=r-t;h.value=p}typeof u.updateTimeDisplay=="function"&&u.updateTimeDisplay(),window.app.graph.setDirtyCanvas(!0,!1),d({...n,startTime:t,endTime:r})}},T=t=>{var r;if(d(t),(r=window.app)!=null&&r.graph){const u=window.app.graph._nodes.find(v=>v.id===t.id);u&&window.app.canvas.centerOnNode(u)}};return e.jsxs("div",{className:"gemini-video-tab",children:[e.jsxs("div",{className:"tab-header",children:[e.jsx("h3",{children:"Gemini Video Trimmer"}),e.jsx("p",{children:"Select a Gemini Video Describe node to trim its uploaded video"})]}),m.length===0?e.jsx("div",{className:"no-nodes",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h4",{children:"No Gemini Video Nodes Found"}),e.jsx("p",{children:'Add a "Gemini Video Describe" node to your workflow and upload a video to start trimming.'})]})}):e.jsxs("div",{className:"nodes-container",children:[e.jsxs("div",{className:"node-selector",children:[e.jsx("label",{children:"Select Node:"}),e.jsxs("select",{value:(n==null?void 0:n.id)||"",onChange:t=>{const r=m.find(l=>l.id.toString()===t.target.value);r&&T(r)},children:[e.jsx("option",{value:"",children:"Choose a node..."}),m.map(t=>e.jsxs("option",{value:t.id,children:["Node ",t.id," ",t.uploadedVideoFile?`(${t.uploadedVideoFile})`:"(No video)"]},t.id))]})]}),n&&a?e.jsxs("div",{className:"video-section",children:[e.jsxs("div",{className:"video-info",children:[e.jsxs("h4",{children:["Node ",n.id]}),e.jsxs("p",{children:["File: ",n.uploadedVideoFile]}),n.duration&&n.duration>0&&e.jsxs("p",{children:["Duration: ",n.duration.toFixed(2),"s"]})]}),e.jsx(P,{videoUrl:a,onTrimChange:V,initialStartTime:n.startTime||0,initialEndTime:n.endTime||n.duration||0})]}):n&&!a?e.jsxs("div",{className:"no-video",children:[e.jsx("h4",{children:"No Video Uploaded"}),e.jsx("p",{children:"This node doesn't have a video uploaded yet. Use the upload button on the node to select a video file."})]}):null]})]})},M={loaders:"#7e57c2",conditioning:"#26a69a",sampling:"#ef5350",latent:"#66bb6a",image:"#42a5f5",mask:"#ff9800","conditioning/clip":"#26a69a","image/postprocessing":"#ec407a",advanced:"#5c6bc0",_default:"#78909c"};function $({nodeCounts:m,totalNodes:c}){const d=Object.entries(m).sort((a,x)=>x[1]-a[1]).slice(0,8).map(([a,x])=>({category:a,count:x,percentage:Math.round(x/c*100)}));return e.jsx("div",{className:"node-stats-chart",children:d.map(a=>e.jsxs("div",{className:"chart-bar-container",children:[e.jsx("div",{className:"chart-bar",style:{height:`${a.percentage*2}px`,backgroundColor:M[a.category]||M._default}}),e.jsx("div",{className:"chart-label",children:a.category})]},a.category))})}function G({categories:m,selectedCategory:c,onSelectCategory:n}){return L(),e.jsxs("div",{className:"category-filter",children:[e.jsx("button",{className:c==="all"?"filter-button active":"filter-button",onClick:()=>n("all"),children:"All"}),m.map(d=>e.jsx("button",{className:c===d?"filter-button active":"filter-button",onClick:()=>n(d),style:{borderBottom:`3px solid ${M[d]||M._default}`},children:d},d))]})}function U(){const{t:m}=L(),[c,n]=o.useState([]),[d,a]=o.useState("all"),[x,N]=o.useState(!1),[b,V]=o.useState(null),[T,t]=o.useState("overview");o.useEffect(()=>{var g,h;if(!((g=window.app)!=null&&g.graph))return;s();function s(){var F,R,D;const p=(F=window.app)==null?void 0:F.graph._nodes;if(!p)return;const w=[];for(const j of p){let E="";if(j.constructor&&"nodeData"in j.constructor){const k=j.constructor.nodeData;k&&typeof k=="object"&&"category"in k&&(E=k.category)}w.push({id:j.id,title:j.title,type:j.type,category:E,inputs:((R=j.inputs)==null?void 0:R.length)||0,outputs:((D=j.outputs)==null?void 0:D.length)||0,pos:[...j.pos]})}n(w)}const i=()=>{s()};return(h=window.app)==null||h.api.addEventListener("graphChanged",i),()=>{var p;(p=window.app)==null||p.api.removeEventListener("graphChanged",i)}},[]),o.useEffect(()=>{var g;if(!((g=window.app)!=null&&g.api))return;const s=()=>N(!0),i=()=>N(!1);return window.app.api.addEventListener("execution_start",s),window.app.api.addEventListener("execution_complete",i),()=>{var h,p;(h=window.app)==null||h.api.removeEventListener("execution_start",s),(p=window.app)==null||p.api.removeEventListener("execution_complete",i)}},[]),o.useEffect(()=>{var p;if(!b||!((p=window.app)!=null&&p.graph))return;const i=window.app.graph._nodes.find(w=>w.id===b);if(!i)return;window.app.canvas.centerOnNode(i);const g=i.color;i.color="#ff5722",window.app.graph.setDirtyCanvas(!0,!1);const h=setTimeout(()=>{var w;(w=window.app)!=null&&w.graph._nodes.includes(i)&&(i.color=g,window.app.graph.setDirtyCanvas(!0,!1))},2e3);return()=>{var w;clearTimeout(h),(w=window.app)!=null&&w.graph._nodes.includes(i)&&(i.color=g,window.app.graph.setDirtyCanvas(!0,!1))}},[b]);const{filteredNodes:r,categories:l,nodeCounts:u,totalNodes:v}=o.useMemo(()=>{const s=d==="all"?c:c.filter(h=>h.category===d),i=[...new Set(c.map(h=>h.category))].sort(),g=c.reduce((h,p)=>{const w=p.category;return h[w]=(h[w]||0)+1,h},{});return{filteredNodes:s,categories:i,nodeCounts:g,totalNodes:c.length}},[c,d]);return e.jsxs("div",{className:"react-example-container",children:[e.jsxs("div",{className:"tab-navigation",children:[e.jsx("button",{className:T==="overview"?"tab-button active":"tab-button",onClick:()=>t("overview"),children:"📊 Overview"}),e.jsx("button",{className:T==="gemini-video"?"tab-button active":"tab-button",onClick:()=>t("gemini-video"),children:"🎬 Gemini Video Trimmer"})]}),T==="overview"?e.jsxs("div",{className:"tab-content",children:[e.jsx("h2",{children:m("app.title")}),e.jsxs("div",{className:"stats-overview",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:v}),e.jsx("div",{className:"stat-label",children:m("app.nodeStats.totalNodes")})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:l.length}),e.jsx("div",{className:"stat-label",children:m("app.nodeStats.uniqueNodeTypes")})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-value",children:x?"Active":"Idle"}),e.jsx("div",{className:"stat-label",children:"Queue Status"})]})]}),e.jsxs("div",{className:"dashboard-section",children:[e.jsx("h3",{children:"Node Type Distribution"}),v>0?e.jsx($,{nodeCounts:u,totalNodes:v}):e.jsx("div",{className:"empty-state",children:m("app.noNodes")})]}),e.jsxs("div",{className:"dashboard-section",children:[e.jsx("h3",{children:m("app.nodeList.title")}),e.jsx(G,{categories:l,selectedCategory:d,onSelectCategory:a}),e.jsx("div",{className:"node-list",children:r.length>0?r.map(s=>e.jsxs("div",{className:"node-item",onClick:()=>V(s.id),children:[e.jsx("div",{className:"node-badge",style:{backgroundColor:M[s.category]||M._default}}),e.jsx("div",{className:"node-title",children:s.title}),e.jsxs("div",{className:"node-meta",children:[e.jsxs("span",{children:[m("app.nodeList.inputs"),": ",s.inputs]}),e.jsxs("span",{children:[m("app.nodeList.outputs"),": ",s.outputs]})]})]},s.id)):e.jsx("div",{className:"empty-state",children:v===0?m("app.noNodes"):"No nodes match the selected filter"})})]}),e.jsxs("div",{className:"dashboard-section",style:{marginTop:"20px"},children:[e.jsx("h3",{children:"API Examples"}),e.jsxs("div",{className:"api-examples",style:{display:"flex",flexWrap:"wrap",gap:"10px"},children:[e.jsx("h4",{children:"Dialog API"}),e.jsx("button",{className:"dialog-btn",onClick:()=>{var s;(s=window.app)==null||s.extensionManager.dialog.prompt({title:"Dialog API Demo",message:"This is a prompt dialog example. Please enter something:",defaultValue:"Dialog API is great!"}).then(i=>{i!==null&&alert(`You entered: ${i}`)})},style:{padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",margin:"5px"},children:"Show Prompt Dialog"}),e.jsx("button",{className:"dialog-btn",onClick:()=>{var s;(s=window.app)==null||s.extensionManager.dialog.confirm({title:"Confirm Action",message:"This is a confirmation dialog example.",type:"default"}).then(i=>{alert(i?"You confirmed!":"You cancelled!")})},style:{padding:"8px 12px",backgroundColor:"#FF9800",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",margin:"5px"},children:"Show Confirm Dialog"}),e.jsx("h4",{children:"Toast API"}),e.jsx("button",{className:"toast-btn",onClick:()=>{var s;(s=window.app)==null||s.extensionManager.toast.add({severity:"info",summary:"Information",detail:"This is an info toast message",life:3e3})},style:{padding:"8px 12px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",margin:"5px"},children:"Show Info Toast"}),e.jsx("button",{className:"toast-btn",onClick:()=>{var s;(s=window.app)==null||s.extensionManager.toast.add({severity:"success",summary:"Success",detail:"Operation completed successfully!",life:3e3})},style:{padding:"8px 12px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",margin:"5px"},children:"Show Success Toast"}),e.jsx("button",{className:"toast-btn",onClick:()=>{var s;(s=window.app)==null||s.extensionManager.toast.add({severity:"warn",summary:"Warning",detail:"This action may cause issues!",life:5e3})},style:{padding:"8px 12px",backgroundColor:"#FF9800",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",margin:"5px"},children:"Show Warning Toast"}),e.jsx("button",{className:"toast-btn",onClick:()=>{var s;(s=window.app)==null||s.extensionManager.toast.add({severity:"error",summary:"Error",detail:"Something went wrong!",life:5e3})},style:{padding:"8px 12px",backgroundColor:"#F44336",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",margin:"5px"},children:"Show Error Toast"}),e.jsx("button",{className:"toast-btn",onClick:()=>{var s;(s=window.app)==null||s.extensionManager.toast.add({severity:"info",summary:"Alert",detail:"This is an alert message!",life:3e3})},style:{padding:"8px 12px",backgroundColor:"#673AB7",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",margin:"5px"},children:"Show Alert Toast"})]})]}),e.jsx("div",{className:"footer",children:e.jsx("p",{children:m("app.footer.clickToHighlight")})})]}):e.jsx("div",{className:"tab-content",children:e.jsx(A,{})})]})}export{U as default};
